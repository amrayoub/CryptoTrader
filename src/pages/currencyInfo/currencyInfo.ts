import { Component } from '@angular/core';
import { NavController, NavParams } from 'ionic-angular';
import { PoloniexService } from '../../providers/poloniexService';
@Component({
    selector: 'page-info',
    templateUrl: 'currencyInfo.html'
})
export class CurrencyInfoPage {
    private marketId: string;
    private currencyId: string;
    private pair: string;
    private tradeHistory: any;
    options: any;
    private bidsX = [];
    private bidsY = [];
    private asks;
    constructor(private navCtrl: NavController, private navParam: NavParams, private poloniexService: PoloniexService) {
        this.marketId = navParam.get("marketId");
        this.currencyId = navParam.get("currencyId");
        this.pair = this.marketId + '_' + this.currencyId;
        this.loadTradeHistory();
        this.loadOrderBook();
    }
    loadOrderBook() {
        let depth = 5;
        this.poloniexService.returnOrderBook(this.pair, depth).subscribe(data => {
            if (data) {
                //this.asks = new Array(depth);
                /*for(let i=0;i<depth;i++){
                    this.asks[i] = [data.asks[i][0],data.asks[i][1]];
                }*/
                this.asks = [[0.00007847, 4202.07608094], [0.00007848, 154.68562981], [0.00007861, 330.09238813], [0.00007863, 2205.54148764], [0.00007894, 13.2758]];
                console.log('asks : ' + this.asks);
            }
        });
        this.options = {
            chart: {
                type: 'area'
            },
            title: {
                text: 'Market Depth - Asks'
            },
            yAxis: {
                title: {
                    text: ''
                }
            },
            series: [{
                name: 'Asks',
                data: [["0.00008059",607.23826621],["0.00008060",2118.87903449],["0.00008070",3.16305693],["0.00008072",1.36928866],["0.00008101",20.456543],["0.00008102",223.39278338],["0.00008105",190.59494494],["0.00008106",1.3788012],["0.00008123",15.34125222],["0.00008124",46.6596],["0.00008149",664.667],["0.00008150",137.82236589],["0.00008153",14.53209799],["0.00008155",3.06560392],["0.00008156",4593.44770751],["0.00008160",6.73986487],["0.00008161",10.27749734],["0.00008165",1.41329661],["0.00008167",6316.42357291],["0.00008168",3872.452],["0.00008170",4060.68443034],["0.00008171",11.02531982],["0.00008175",1.66348803],["0.00008177",1192.79321096],["0.00008178",815.35966231],["0.00008179",135.46627608],["0.00008180",2.18985972],["0.00008187",1.391],["0.00008190",705.71370399],["0.00008191",311.43391244],["0.00008197",81.96800345],["0.00008199",1.67598269],["0.00008200",8809.08280378],["0.00008201",48.20874845],["0.00008216",671.33876145],["0.00008219",108.52316586],["0.00008220",3871.36412055],["0.00008224",7536.78443875],["0.00008225",4579.93527008],["0.00008228",12.40863374],["0.00008229",552.01275325],["0.00008230",998.5],["0.00008233",1.24921806],["0.00008235",53.9379013],["0.00008236",50.70846617],["0.00008237",20.3],["0.00008242",63.69731801],["0.00008243",99.27997083],["0.00008244",1305],["0.00008247",12.98500634],["0.00008249",29.38303625],["0.00008257",6.04261327],["0.00008268",1474.21823772],["0.00008272",40.69012247],["0.00008273",10200],["0.00008279",1.38359049],["0.00008283",66.30217362],["0.00008285",11.02531982],["0.00008290",500],["0.00008300",26069.26023181],["0.00008303",34.80690729],["0.00008306",31.96146583],["0.00008307",14635.22154447],["0.00008316",53.39390567],["0.00008317",72.78331809],["0.00008319",32.08626124],["0.00008327",18.61172853],["0.00008328",44.77433721],["0.00008330",20000],["0.00008333",37.34340678],["0.00008337",15.15149286],["0.00008339",3.96999499],["0.00008340",290.47272727],["0.00008342",8.85020906],["0.00008343",11.02531982],["0.00008345",49.875],["0.00008355",1000],["0.00008375",136.90082764],["0.00008380",1970.61872225],["0.00008381",35.72569098],["0.00008390",426.23051729],["0.00008391",7386.28880436],["0.00008400",5272.71148159],["0.00008423",75.14360134],["0.00008443",630.34474243],["0.00008446",19.36794924],["0.00008447",43.51529592],["0.00008448",20.3],["0.00008449",120.16585064],["0.00008450",1.74988233],["0.00008452",21.66320325],["0.00008457",38.62251381],["0.00008458",192.35749856],["0.00008459",69.7618276],["0.00008460",76.64404842],["0.00008462",318.6495484],["0.00008463",140.5807835],["0.00008464",65.84778767],["0.00008465",14.43041212],["0.00008476",7311.94221561]]
            }]
        };
    }
    loadTradeHistory() {
        let now = Math.round(new Date().getTime() / 1000);
        let before = now - 600; //5min
        this.poloniexService.returnTradeHistory(this.pair, before, now).subscribe(data => {
            let help: Array<{}> = new Array<{}>();
            if (data) {
                let max = data.length > 20 ? 20 : data.length; //just last 20 orders
                for (var index = 0; index < max; index++) {
                    help.push(data[index]);
                }
                this.tradeHistory = help;
            } else {
                this.tradeHistory = data;
            }
        });
    }
    doRefresh(refresher) {
        console.log('refresh');
        this.loadTradeHistory();
        refresher.complete();
    }
}
